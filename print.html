<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Matrix Cerberus Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="setup.html"><strong aria-hidden="true">2.</strong> Installation and Setup</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Matrix Cerberus Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MatrixDoctors/matrix-cerberus" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="matrix-cerberus"><a class="header" href="#matrix-cerberus">matrix-cerberus</a></h1>
<p><strong>matrix-cerberus</strong> is an application that has the ability to delegate membership of a room based on a userâ€™s interaction with other third party services.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>Send automatic invites to authorized users.</li>
<li>Update room memberships based on current user's state(Invite, Kick)</li>
<li>Admin panel for configuring relationships between rooms and users.</li>
<li>Generate external invite URLs for a room.</li>
</ul>
<h2 id="supported-third-party-accounts"><a class="header" href="#supported-third-party-accounts">Supported third party accounts</a></h2>
<ul>
<li>GitHub</li>
<li>Patreon</li>
</ul>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>You can find the documentation <a href="https://matrixdoctors.github.io/matrix-cerberus/">here</a>.</p>
<h2 id="contact-us"><a class="header" href="#contact-us">Contact Us</a></h2>
<p>If you have any ideas that you want to share or have any queries then feel free to join the public room <a href="https://matrix.to/#/#matrix-cerberus:cadair.com">#matrix-cerberus:cadair.com</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-and-setup"><a class="header" href="#installation-and-setup">Installation and Setup</a></h1>
<p>In this page we go over how to setup the application for both development and production.</p>
<h2 id="local-installation"><a class="header" href="#local-installation">Local Installation</a></h2>
<p>To clone the repo and install locally run</p>
<pre><code class="language-bash">git clone https://github.com/MatrixDoctors/matrix-cerberus.git
cd matrix-cerberus
</code></pre>
<h2 id="production-setup"><a class="header" href="#production-setup">Production Setup</a></h2>
<h3 id="configuration-files"><a class="header" href="#configuration-files">Configuration files</a></h3>
<p>First comes the configuration files.
This contains all of your sensitive data (i.e third party app IDs and secrets), custom configuration, domain address and other essesntial details which will be required to get your app running properly.</p>
<p>List of configuration and environment files for production:</p>
<ul>
<li><code>config.yml</code> for backend</li>
<li><code>.env.production</code> for frontend</li>
<li><code>nginx.conf</code> in <code>nginx/prod</code> for nginx</li>
</ul>
<h4 id="1-backend-configuration-configyml"><a class="header" href="#1-backend-configuration-configyml">1) Backend configuration (config.yml)</a></h4>
<p>Copy the <code>config.sample.yml</code> to a new file <code>config.yml</code> and edit the configuration as mentioned in the file.</p>
<p>The current <code>config.sample.yml</code> file is configured to be used by the backend tests to test its interactions and functionality.</p>
<h4 id="2-frontend-configuration-envproduction"><a class="header" href="#2-frontend-configuration-envproduction">2) Frontend configuration (.env.production)</a></h4>
<p>Copy the <code>.env.test</code> to a new file <code>.env.production</code>.</p>
<p>Edit the <code>REACT_APP_BASE_URL</code> to the domain url that you intend to host the application on.</p>
<p>You can also optionally edit the <code>REACT_APP_DEFAULT_HOMESERVER</code> to view this homeserver by default when the login page loads for the first time.</p>
<h4 id="3-nginx-configuration-nginxconf"><a class="header" href="#3-nginx-configuration-nginxconf">3) Nginx configuration (nginx.conf)</a></h4>
<p>Copy the <code>nginx.sample.conf</code> to a new file <code>nginx.conf</code> under the same directory (<code>nginx/prod</code>).</p>
<p>Edit the <code>DOMAIN_URL</code> to the domain url that you intend to host the application on.</p>
<h3 id="how-to-issue-ssl-certificates-for-your-domain"><a class="header" href="#how-to-issue-ssl-certificates-for-your-domain">How to issue SSL certificates for your domain?</a></h3>
<p>It is very important to make sure that the application supports HTTPS requests to protect the website and its users from other external factors.</p>
<p>In the docker compose <a href="../docker-compose.yml">file</a>, we've mapped the the local files in certbot directory with other directories which belong to the nginx docker container.</p>
<p>This is to ensure that we keep using the same SSL certificates that has been generated the first time this app has been setup and also to share the data between two different containers i.e. nginx and certbot.</p>
<pre><code>  nginx:
    image: &quot;nginx:latest&quot;
    volumes:
      - ./nginx/prod/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./nginx/prod/corsheaders.conf:/etc/nginx/conf.d/corsheaders.conf:ro
      - ./certbot/conf:/etc/letsencrypt:ro
      - ./certbot/www:/var/www/certbot/:ro
      - ./frontend/build:/usr/src/app
</code></pre>
<pre><code>certbot:
    image: certbot/certbot:latest
    volumes:
      - ./certbot/conf:/etc/letsencrypt:rw
      - ./certbot/www/:/var/www/certbot/:rw
</code></pre>
<p>Run the following command to fill the <code>certbot</code> directory with certificates.</p>
<pre><code class="language-bash">docker-compose run --rm  certbot certonly --webroot --webroot-path /var/www/certbot/ -d {DOMAIN_URL}
</code></pre>
<p><strong>Note:</strong>
There is a limit to how many certificates can be generated per registered domain. (It is 50 per week)
Please check out <a href="https://letsencrypt.org/docs/rate-limits/">https://letsencrypt.org/docs/rate-limits/</a></p>
<p>The generated certificates are only valid for 3 months. To renew the certificates run the command</p>
<pre><code>docker-compose run --rm certbot renew
</code></pre>
<p>If you run into any issues while setting up https and certbot, do check out the <a href="https://mindsers.blog/post/https-using-nginx-certbot-docker/">article</a> or join <a href="https://matrix.to/#/#matrix-cerberus:cadair.com">#matrix-cerberus:cadair.dev</a> so that we can work out a solution together!</p>
<h3 id="time-to-run-the-application"><a class="header" href="#time-to-run-the-application">Time to run the application!</a></h3>
<p>Now, that you have everything setup, you can simply start the application by running the commands</p>
<pre><code>docker-compose build
docker-compose up
</code></pre>
<h2 id="development-setup"><a class="header" href="#development-setup">Development Setup</a></h2>
<p>This is for those who intend to contribute to this project (thank you!) or would like to play around a bit with the app by setting it up locally.</p>
<h3 id="configuration-files-1"><a class="header" href="#configuration-files-1">Configuration files</a></h3>
<p>The configuration files are similar to the ones in production except for a few changes.</p>
<p>List of configuration and environment files for development:</p>
<ul>
<li><code>config.yml</code> for backend</li>
<li><code>.env.development</code> for frontend</li>
</ul>
<h4 id="1-backend-configuration-configyml-1"><a class="header" href="#1-backend-configuration-configyml-1">1) Backend configuration (config.yml)</a></h4>
<p>You can follow the same instructions mentioned in <a href="setup.html#1-backend-configuration-configyml">here</a></p>
<h4 id="2-frontend-configuration-envdevelopment"><a class="header" href="#2-frontend-configuration-envdevelopment">2) Frontend configuration (.env.development)</a></h4>
<p>Copy the <code>.env.test</code> to a new file <code>.env.development</code>.</p>
<p>You can use the same configuration in <code>.env.test</code> as is without changing anything.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
